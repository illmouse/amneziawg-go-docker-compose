services:
  awg:
    image: ghcr.io/illmouse/amneziawg-go:latest
    container_name: amneziawg
    deploy:
      resources:
        limits:
          memory: 2g
        reservations:
          memory: 512m
    ulimits:
      nofile:
        soft: 65535
        hard: 65535
      nproc:
        soft: 20000
        hard: 20000
    cap_add:
      - NET_ADMIN
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      # - ${PROXY_SOCKS5_PORT}:${PROXY_SOCKS5_PORT}/tcp
      - ${PROXY_HTTP_PORT}:${PROXY_HTTP_PORT}/tcp
      - ${WG_PORT}:${WG_PORT}/udp
    volumes:
      - ./config:/etc/amneziawg
      - ./logs:/var/log/amneziawg
      - ./logs/3proxy:/var/log/3proxy
      # - ./config/3proxy.cfg:/etc/3proxy/3proxy.cfg
    restart: always
    env_file:
      - .env
    networks:
      awg:

networks:
   awg:
